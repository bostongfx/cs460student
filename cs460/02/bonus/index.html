<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CS460 – A2 Bonus: Spheres + Camera Cycle</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    html,body{margin:0;height:100%;background:#000;color:#fff;font:16px system-ui}
    header{text-align:center;padding:12px 0}
    #r{width:100vw;height:72vh;display:block}
    kbd{padding:2px 6px;border:1px solid #888;border-bottom-width:2px;border-radius:4px;background:#111}
    #hud{position:fixed;left:12px;bottom:12px;background:rgba(0,0,0,.6);border:1px solid #333;border-radius:8px;padding:8px 10px;font-size:13px}
  </style>
</head>
<body>
  <header>
    <h1>A2 Bonus – Spheres + Camera Cycle</h1>
    <div>Keys:
      <kbd>C</kbd> save camera,
      <kbd>V</kbd> play/stop camera tour,
      <kbd>O</kbd> download scene,
      <kbd>L</kbd> load <code>scene.json</code> (from parent folder).
    </div>
  </header>
  <div id="r" tabindex="0"></div>
  <div id="hud">cams: <span id="cams">0</span> • tour: <span id="tour">off</span></div>

  <!-- reuse libs from the parent folder -->
  <script src="../xtk.js"></script>
  <script src="../loader.js"></script>
  <script>
    // Use the same global names loader.js expects:
    var r;
    // Let loader.js also see/modify CAMERAS if needed
    window.CAMERAS = window.CAMERAS || [];

    var tourTimer = null, tourIndex = 0;

    const SIZE = 6, GAP = 2;

    function updateHUD(){
      document.getElementById('cams').textContent = window.CAMERAS.length;
      document.getElementById('tour').textContent = tourTimer ? 'on' : 'off';
    }

    window.onload = function () {
      r = new X.renderer3D(); r.container = 'r'; r.init();

      // Spheres with random sizes/colors (11×11×11)
      for (var z=-5; z<=5; z++) {
        for (var y=-5; y<=5; y++) {
          for (var x=-5; x<=5; x++) {
            var s = new X.sphere();
            s.radius = 2 + Math.random()*4;
            s.color = [Math.random(), Math.random(), Math.random()];
            s.transform.translateX((SIZE+GAP)*x);
            s.transform.translateY((SIZE+GAP)*y);
            s.transform.translateZ((SIZE+GAP)*z);
            r.add(s);
          }
        }
      }

      r.camera.position = [0,0,380];
      r.render();
      updateHUD();

      // More reliable than keypress across browsers
      window.addEventListener('keydown', function(e){
        const k = e.key.toLowerCase();

        if (k === 'c') {
          // save current camera pose
          window.CAMERAS.push(new Float32Array(r.camera.view));
          updateHUD();
        }

        if (k === 'v') {
          // toggle the tour
          if (tourTimer) { clearInterval(tourTimer); tourTimer = null; updateHUD(); return; }
          if (!window.CAMERAS.length) return;
          tourIndex = 0;
          tourTimer = setInterval(function(){
            r.camera.view = new Float32Array(window.CAMERAS[tourIndex]);
            tourIndex = (tourIndex + 1) % window.CAMERAS.length;
          }, 1000);
          updateHUD();
        }

        if (k === 'o' && typeof download === 'function') {
          download();
        }
        
        if (k === 'l' && typeof upload === 'function') {
        upload('scene.json');   
        return;
        }

      });
    };
  </script>
</body>
</html>
