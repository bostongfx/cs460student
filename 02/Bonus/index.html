<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CS460 – A02 Bonus (Spheres + Camera Tour)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body { height:100%; margin:0; background:#0f0f12; }
    #r { width:100%; height:100%; }
    .hint{ position:fixed; left:10px; bottom:10px; color:#ddd; font:12px monospace; opacity:.9; user-select:none; pointer-events:none; }
  </style>

  <!-- XTK (same build as your main page) -->
  <script type="text/javascript" src="https://get.goXTK.com/xtk_edge.js"></script>
  <!-- your save/load helper -->
  <script src="loader.js"></script>
</head>
<body>
  <div id="r"></div>
  <div class="hint">
    Hover/click to select • Q=hide • W=color • E=rotateX • B=spin • C=save cam • V=tour • O=download • L=load
  </div>

  <script>
    // --------- globals ----------
    window.r = window.r || null;         // keep global for loader.js
    let SELECTED = null;
    let LAST = {x:0,y:0};
    let SPIN = false;

    // bonus: camera tour
    let CAMERAS = [];
    let TOUR = null;

    const SIZE = 6, GAP = 2, STEP = SIZE + GAP; // same spacing as cubes

    // ------- canvas + picking helpers (hiDPI accurate) -------
    function getCanvas(){
      return (window.r && window.r._canvas) || document.querySelector('#r canvas') || document.querySelector('canvas');
    }
    function toCanvasXY(ev){
      const c = getCanvas(); if(!c) return {x:0,y:0};
      const rect = c.getBoundingClientRect();
      const sx = c.width / rect.width, sy = c.height / rect.height;
      return {
        x: Math.max(0, Math.min(c.width,  (ev.clientX - rect.left) * sx)),
        y: Math.max(0, Math.min(c.height, (ev.clientY - rect.top ) * sy))
      };
    }
    function pickAt(x,y){
      const id = window.r.pick(x,y);
      SELECTED = id ? window.r.get(id) : null;
    }
    function ensureSelection(){
      if (!SELECTED) pickAt(LAST.x, LAST.y);
      return !!SELECTED;
    }

    // ------------- main -------------
    window.onload = function(){
      // 1) renderer
      window.r = new X.renderer3D();
      r.container = 'r';
      r.init();

      // 2) spheres with RANDOM SIZES (0.6–1.5x) and soft colors
      for (let z=-5; z<=5; z++){
        for (let y=-5; y<=5; y++){
          for (let x=-5; x<=5; x++){
            const s = new X.sphere();
            s.transform.scale = 0.6 + Math.random()*0.9;               // ← random size
            s.transform.translateX(STEP * x);
            s.transform.translateY(STEP * y);
            s.transform.translateZ(STEP * z);
            s.color = [0.6+0.4*Math.random(), 0.6+0.4*Math.random(), 0.6+0.4*Math.random()];
            r.add(s);
          }
        }
      }

      // 3) camera + interactor (keep your cube behavior)
      r.camera.position = [0,0,360];

      r.interactor.onMouseMove = function(ev){
        LAST = toCanvasXY(ev);
        pickAt(LAST.x, LAST.y);
      };
      r.interactor.onMouseDown = function(ev){
        LAST = toCanvasXY(ev);
        pickAt(LAST.x, LAST.y);
      };

      // 4) keys: keep Q/W/E + add C/V + O/L + B
      window.addEventListener('keydown', (e)=>{
        const k = (e.key || '').toLowerCase();

        // no selection needed
        if (k === 'b') { SPIN = !SPIN; return; }
        if (k === 'o' && typeof download === 'function') { download(); return; }
        if (k === 'l' && typeof upload   === 'function') { upload('scene.json'); return; }

        // save camera view
        if (k === 'c') {
          const v = (r.camera.view || []).slice();
          if (v.length) { CAMERAS.push(v); flash(`saved view #${CAMERAS.length}`); }
          else { flash('camera view not available'); }
          return;
        }

        // play/stop tour
        if (k === 'v') {
          if (!CAMERAS.length) { flash('press C a few times first'); return; }
          if (TOUR) { clearInterval(TOUR); TOUR = null; flash('tour stopped'); }
          else {
            let i = 0;
            TOUR = setInterval(()=>{ r.camera.view = CAMERAS[i++ % CAMERAS.length]; }, 1000);
            flash('tour started');
          }
          return;
        }

        // selection-required keys (SAME as cubes)
        if (!ensureSelection()) return;
        if (k === 'q')       SELECTED.visible = false;                                 // hide
        else if (k === 'w')  SELECTED.color = [Math.random(), Math.random(), Math.random()]; // recolor
        else if (k === 'e')  SELECTED.transform.rotateX(10);                           // rotate
      });

      // 5) render loop
      r.onRender = function(){
        if (SPIN) r.camera.rotate([0.5,0]);
      };

      r.render();
    };

    // tiny HUD for feedback
    function flash(t){
      let hud = document.getElementById('hud');
      if(!hud){
        hud = document.createElement('div');
        hud.id='hud';
        hud.style.cssText='position:fixed;right:10px;top:10px;background:rgba(0,0,0,.45);color:#eee;padding:6px 8px;border-radius:6px;font:12px monospace';
        document.body.appendChild(hud);
      }
      hud.textContent = t;
      clearTimeout(hud._t); hud._t = setTimeout(()=> hud.textContent='', 1400);
    }
  </script>
</body>
</html>
