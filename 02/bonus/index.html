<html>
<head>
    <style>
    body{background-color: black;}
    </style>
        <script type="text/javascript" src="https://get.goXTK.com/xtk_edge.js"></script>
        <script type="text/javascript" src=loader.js></script>
    <script>
  	window.onload = function(){
        
  		r = new X.renderer3D();
  		r.init();


      var SIZE = 20;
      var GAP = 20;
      var SELECTED_SPHERE;
      let toggleB = false;
      let toggleV = true;
      let startV;
      var c;
      const CAMERAS = [];
      let cameraIndex = 0;

  		for (var z=-5; z < 6; z++){ //100 cubes 10*10*10
         for (var y=-5; y < 6; y++){
            for(var x=-5; x < 6; x++){
               new_sphere = new X.sphere();
               new_sphere.transform.translateX((SIZE + GAP) * x);
               new_sphere.transform.translateY((SIZE + GAP) * y);
               new_sphere.transform.translateZ((SIZE + GAP) * z);
               new_sphere.radius = Math.random()*20;
               r.add(new_sphere);
            }
         }	
      }
        
        r.render();
        r.camera.position = [0,0,300];
        ///*
        r.interactor.onMouseMove = function(event){
            cubeid = r.pick(event.offsetX, event.offsetY);
            if (cubeid != 0){
               SELECTED_SPHERE=r.get(cubeid);
               //console.log(SELECTED_SPHERE);
            }
		}
        
        window.onkeypress = function(e){
            if (e.key == 'q'){
               SELECTED_SPHERE.visible = false;
            }else if (e.key == 'w'){
               var x =  Math.random();
               var y =  Math.random();
               var z =  Math.random();
               SELECTED_SPHERE.color = [x,y,z];
            }else if (e.key == 'e'){
               SELECTED_SPHERE.transform.rotateX(10);
            }else if (e.key == 'b'){
               toggleB = !toggleB;
               //console.log(toggleB);
               r.onRender = function(){
               // spin the camera in X direction by 1 degree
                  if (!toggleB){
                     return;
                  }else{
                     r.camera.rotate([1, 0]);
                  }
               }
            }else if (e.key == 'o'){
               download();
            }else if (e.key == 'l'){
               upload("scene.json");
               c = new X.sphere();
               r.add(c);
            }else if (e.key == 'c'){
               CAMERAS.push(new Float32Array(r.camera.view));
               //console.log(CAMERAS);
               //console.log("check0");
            }else if (e.key == 'v'){
               toggleV = !toggleV;
               if (!toggleV){
                  clearInterval(startV);
                  //console.log("check1");
                  return;
               }else{
                  cameraIndex = 0;
                  r.camera.view = new Float32Array(CAMERAS[cameraIndex]);
                  startV = setInterval(function(){
                     cameraIndex = (cameraIndex + 1) % CAMERAS.length;
                     r.camera.view = new Float32Array(CAMERAS[cameraIndex]);
                     //console.log("in loop" + cameraIndex);
                  }, 1000);
               }
            }
        }
    }
    </script>
</head>
<body>
</body>
</html>