<html>
  <head>

      <style>
        body {
            background-color: black;
        }
      </style>

      <script type="text/javascript" src="https://get.goXTK.com/xtk_edge.js"></script>
      <script type="text/javascript" src="loader.js"></script>

      <script>

      	var SIZE = 12
      	var GAP = 4
      	var cube_selected = null
      	var spin = false
      	var cubes = [];
      	window.onload = function() {

              // once everything is done loading

              r = new X.renderer3D();
              r.container = document.body;
              r.init();
              
              
              for (var z=-5; z < 6; z++) {
								for (var y=-5; y < 6; y++) {
									for(var x=-5; x < 6; x++) {
						new_cube = new X.cube();

						new_cube.lengthX = SIZE;
              			new_cube.lengthY = SIZE;
              			new_cube.lengthZ = SIZE;

						new_cube.transform.translateX((SIZE + GAP) * x);
						new_cube.transform.translateY((SIZE + GAP) * y);
						new_cube.transform.translateZ((SIZE + GAP) * z);
						cubes.push(new_cube);
						r.add(new_cube);
					}
				}
			 }

			 r.interactor.onMouseMove = function(event) {
				cubeid = r.pick(event.offsetX, event.offsetY) ;
				cube_selected = r.get(cubeid)
				/*if (cube_selected) {
    			cube_selected.color = [1, 0, 0]; // red highlight
  				};*/
			};

			window.onkeypress = function(e) {
				if (e.key == 'q' && cube_selected) {
					cube_selected.visible = false;
				}

				if (e.key == 'w' && cube_selected) {
					cube_selected.color = [Math.random(),Math.random(),Math.random()];
				}

				if (e.key == 'e' && cube_selected) {
					cube_selected.transform.rotateX(10);
				}

				if (e.key == 'b'){
					spin = !spin;
				}
				
  				if (e.key == 'o') {  
  					download();
					return
				}
				if (e.key == 'l') {
    				upload('scene.json');
  					return;
				}
			}
			

              
              

			r.onRender = function() {
				var t = performance.now() / 500; // time factor

  			for (var i = 0; i < cubes.length; i++) {
    			var c = cubes[i];

    			// rotate
    			c.transform.rotateY(2);

    			// RGB
    			var rr = 0.5 + 0.5 * Math.sin(t + i*0.3);
    			var gg = 0.5 + 0.5 * Math.sin(t*1.3 + i*0.35);
    			var bb = 0.5 + 0.5 * Math.sin(t*1.7 + i*0.4);
    			c.color = [rr, gg, bb];
  			}

				if (spin){
					r.camera.rotate([1, 0]);
				}	
			}

              
			 r.camera.position = [0, 0, 300];
              // render
              r.render();
          };
      </script>

  </head>
  <body>
  </body>
</html>

